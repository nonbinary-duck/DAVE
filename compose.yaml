services:
  dave:
    build: .
    image: dave_app:latest
    container_name: dave
    restart: unless-stopped

    # --------------------------------------------------------------------
    # 1️⃣  Runtime knobs – override the Dockerfile defaults
    # --------------------------------------------------------------------
    environment:
      - GRADIO_PORT=7860          # (unused by demo_zero_gradio.py but kept for future UI)
      - MODEL_PATH=/app/DAVE/weights
      - IMAGE_SIZE=384
      - CUDA_VISIBLE_DEVICES=0    # set to '' if you don’t want to expose a GPU
      - PYTHONUNBUFFERED=1
      - PROMPT_TXT='strawberries'
      - IMG_PTH='/examples/neat_mix.jpg'

    ports:
      - "7860:7860"          # host_port:container_port

    volumes:
      - ./examples:/examples/:rw
      - ./VisDrone:/VisDrone/:r

    # --------------------------------------------------------------------
    # 2️⃣  Request a GPU – adjust if you’re on Swarm or single‑node Docker‑Compose
    # --------------------------------------------------------------------
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  mongo:
    image: mongo
    restart: always
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example1234
    volumes:
      - ./mongo_data:/data/db


  mongo-express:
    image: mongo-express
    restart: always
    ports:
      - 8081:8081
    environment:
      ME_CONFIG_MONGODB_URL: mongodb://root:example1234@mongo:27017/
      ME_CONFIG_BASICAUTH_ENABLED: true
      ME_CONFIG_BASICAUTH_USERNAME: mongoexpressuser
      ME_CONFIG_BASICAUTH_PASSWORD: mongoexpresspass